name: Run tests on Testing Farm

on:
  push:
    branches: [ master, container-tests ]
  pull_request:

jobs:
  tests-fedora:
    runs-on: ubuntu-latest

    permissions:
      contents: read
      pull-requests: write
      statuses: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Tests on Fedora VM
        strategy:
          matrix:
            regex: [init, upgrade]
        uses: sclorg/testing-farm-as-github-action@main
        with:
          api_key: ${{ secrets.TESTING_FARM_API_TOKEN }}
          compose: Fedora-Rawhide
          tmt_path: "tmt"
          tmt_plan_regex: "plans/fedora-${{ matrix.regex }}"
          pull_request_status_name: "Fedora ${{ matrix.regex }} test"
          update_pull_request_status: "true"
          create_github_summary: "true"
  
 tests-container:
    runs-on: ubuntu-latest

    permissions:
      contents: read
      pull-requests: write
      statuses: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Tests on Fedora container
        strategy:
          matrix:
            regex: [init, upgrade]
        uses: sclorg/testing-farm-as-github-action@main
        with:
          api_key: ${{ secrets.TESTING_FARM_API_TOKEN }}
          compose: null
          tmt_path: "tmt"
          tmt_plan_regex: "container-fedora-${{ matrix.regex }}"
          pull_request_status_name: "Fedorat ${{ matrix.regex }} test in container"
          update_pull_request_status: "true"
          create_github_summary: "true"

