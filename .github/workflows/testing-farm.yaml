name: Run tests on Testing Farm

on:
  push:
    branches: [ master, container-tests ]
  pull_request:

jobs:
  test-init:
    runs-on: ubuntu-latest

    permissions:
      contents: read
      pull-requests: write
      statuses: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Test init on Fedora VM
        uses: thrix/testing-farm-as-github-action@fix-compose-null-handling
        with:
          api_key: ${{ secrets.TESTING_FARM_API_TOKEN }}
          compose: Fedora-Rawhide
          tmt_path: "tmt"
          tmt_plan_regex: "plans/fedora-init"
          pull_request_status_name: "Fedora init test"
          update_pull_request_status: "true"
          create_github_summary: "true"


  test-upgrade:
    runs-on: ubuntu-latest

    permissions:
      contents: read
      pull-requests: write
      statuses: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Test upgrade on Fedora VM
        uses: sclorg/testing-farm-as-github-action@v4
        with:
          api_key: ${{ secrets.TESTING_FARM_API_TOKEN }}
          compose: Fedora-Rawhide
          tmt_path: "tmt"
          tmt_plan_regex: "plans/fedora-upgrade"
          pull_request_status_name: "Fedora upgrade test"
          update_pull_request_status: "true"
          create_github_summary: "true"
                                  

  test-init-container:
    runs-on: ubuntu-latest

    permissions:
      contents: read
      pull-requests: write
      statuses: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Test init on Fedora container
        uses: sclorg/testing-farm-as-github-action@v4
        with:
          api_key: ${{ secrets.TESTING_FARM_API_TOKEN }}
          compose: null
          tmt_path: "tmt"
          tmt_plan_regex: "container-fedora-init"
          pull_request_status_name: "Fedora init test in container"
          update_pull_request_status: "true"
          create_github_summary: "true"


  test-upgrade-container:
    runs-on: ubuntu-latest

    permissions:
      contents: read
      pull-requests: write
      statuses: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Test upgrade on Fedora container
        uses: sclorg/testing-farm-as-github-action@v4
        with:
          api_key: ${{ secrets.TESTING_FARM_API_TOKEN }}
          compose: null
          tmt_path: "tmt"
          tmt_plan_regex: "container-fedora-upgrade"
          pull_request_status_name: "Fedora upgrade test in container"
          update_pull_request_status: "true"
          create_github_summary: "true"


